<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Configuration</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin-top: 50px;
        }
        .sidebar {
            height: 100%;
            width: 250px;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #111;
            padding-top: 20px;
        }
        .sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            font-size: 18px;
            color: white;
            display: block;
        }
        .sidebar a:hover {
            background-color: #575757;
        }
        .content {
            margin-left: 260px;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="/">Home</a>
        <a href="/configuration">Configuration</a>
        <a href="/arrosage_history">Historique des arrosages</a>
    </div>
    <div class="content">
        <h1>Configuration des Scénarios</h1>
        <form id="configForm">
            <div id="scenarios"></div>
            <button type="submit" class="btn btn-primary">Enregistrer</button>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            fetch('/configuration')
                .then(response => response.json())
                .then(data => {
                    const scenariosDiv = document.getElementById('scenarios');
                    data.scenarios.forEach((scenario, index) => {
                        const scenarioDiv = document.createElement('div');
                        scenarioDiv.classList.add('form-group');
                        scenarioDiv.innerHTML = `
                            <h3>Scénario ${index + 1}</h3>
                            <label>Humidité du sol :</label>
                            <input type="text" class="form-control" name="soil_humidity_${index}" value="${scenario.soil_humidity}" required>
                            <label>Température de l'air :</label>
                            <input type="text" class="form-control" name="air_temperature_${index}" value="${scenario.air_temperature}" required>
                            <label>Humidité de l'air :</label>
                            <input type="text" class="form-control" name="air_humidity_${index}" value="${scenario.air_humidity}" required>
                            <label>Action :</label>
                            <input type="text" class="form-control" name="action_${index}" value="${scenario.action}" required>
                            <label>Durée d'arrosage (minutes) :</label>
                            <input type="number" class="form-control" name="duration_${index}" value="${scenario.duration}" required>
                        `;
                        scenariosDiv.appendChild(scenarioDiv);
                    });
                });

            document.getElementById('configForm').addEventListener('submit', function(event) {
                event.preventDefault();
                const scenarios = [];
                document.querySelectorAll('.form-group').forEach((group, index) => {
                    const scenario = {
                        soil_humidity: group.querySelector(`[name="soil_humidity_${index}"]`).value,
                        air_temperature: group.querySelector(`[name="air_temperature_${index}"]`).value,
                        air_humidity: group.querySelector(`[name="air_humidity_${index}"]`).value,
                        action: group.querySelector(`[name="action_${index}"]`).value,
                        duration: parseInt(group.querySelector(`[name="duration_${index}"]`).value)
                    };
                    scenarios.push(scenario);
                });

                fetch('/set_scenarios', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ scenarios: scenarios })
                })
                .then(response => {
                    if (response.ok) {
                        alert('Configuration enregistrée');
                    } else {
                        return response.text().then(text => { throw new Error(text); });
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    </script>
</body>
</html>
